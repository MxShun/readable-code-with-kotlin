# 5章 コメントすべきことを知る *Knowing What to Comment*
コメントの目的は、書き手の意図を読み手に知らせることである。

- コメントするべきではないことを知る
- コードを書いているときの自分の考えを記録する
- 読み手の立場になって何が必要になるかを考える

### 5.1 コメントするべきではないこと *What NOT to Comment*
コメントを読むとその分だけコードを読む時間がなくなる。コメントは画面を占領してしまう。言い換えれば、コメントにはそれだけの価値を持たせるべきなんだ。

コードからすぐにわかることをコメントに書かない。
逆に言えば、コードを理解するよりも、コメントを読んだ方が早く理解できる場合には価値がある。

コメントはひどい名前の埋め合わせに使うものではない。優れたコメントよりも関数・変数の名前の方が大切だ。
プログラマはこのことを「優れたコード > ひどいコード + 優れたコメント」と言っている。

### 5.2 自分の考えを記録する *Recording Your Thoughts*
優れたコメントというのは考えを記録するためのものである。コードを書いているときに持っている大切な考えを記録しなければいけない。

次の場合、コメントから情報を得られるので、下手に最適化しようとして無駄に時間を使う必要がなくなる。

```
// このデータだとハッシュテーブルよりもバイナリツリーの方が 40% 速かった。
// 左右の比較よりもハッシュの計算コストの方が高いようだ。
```

このコメントがなければ、失敗するテストケースに無駄な時間をかえることになるかもしれない。あるいは、バグだと思って修正したくなるだろう。

```
// ヒューリスティックだと単語が漏れることがあるが仕方ない。100% は難しい。
```

このコメントはコードが汚いことを認めている。そして、誰かに修正を促している。コメントがなければ、コードが汚くて誰も近づかなかっただろう。

```
// このクラスは汚くなってきている。
// サブクラス ResourceNode を使って整理した方がいいかもしれない。
```

| 記法 | 典型的な意味 |
| --- | --- |
| TODO: | あとで手をつける |
| FIXME: | 既知の不具合があるコード |
| HACK: | あまりキレイじゃない解決策 |
| XXX: | 危険！大きな問題がある |

### 5.3 読み手の立場になって考える *Anticipating Likely Questions*
本書で使っている技法は、他の人にコードがどのように見えるかを想像するものだ。他の人というのは、プロジェクトのことを君のように熟知していない人のことである。

次のような C++ コードがあったとする。このコードを見たプログラマは「どうして単純に data.clear() せずに空のベクタをスワップするんだ？」と疑問に思うだろう。
このようにしているのは、ベクタのメモリを開放してメモリアロケータに戻す方法がこれしかないからだ。これはあまり知られていないことである。つまり、ここにコメントをつけるべきなのだ。

```
struct Recorder {
    vector<float> data;
    void Clear() {
        // ベクタのメモリを開放する（「STL swap 技法」で検索してみよう）
        vector<float>().swap(data);
    }
} 
```

関数やクラスを文書化するときには、「このコードを見てビックリすることは何だろう？どんなふうに間違えて使う可能性があるのだろう？」と自分に問いかけるといい。

また、新しいチームメンバーにとって最も難しいのは全体像の理解である。高レベル・低レベルコードの全体像についてコメントするのはいい考えだ。

### 5.4 ライターズブロックを乗り越える *Final Thoughts - Getting Writer's Block*
プログラマの多くはコメントを書きたがらない。コメントをうまく書くのは大変だと思っているからだ。こうしたライターズロックを乗り越えるには、とにかく書き始めるしかない。

コメントを書く作業は、3つの簡単な手順に分解できる。

- 頭の中にあるコメントをとにかく書き出す
- コメントを読んで（どちらかと言えば）改善が必要なものを見つける
- 改善する
